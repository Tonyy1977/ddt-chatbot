"use strict";(()=>{var a={};a.id=14,a.ids=[14],a.modules={5600:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5988:(a,b,c)=>{c.r(b),c.d(b,{config:()=>A,default:()=>z,handler:()=>C});var d={};c.r(d),c.d(d,{default:()=>w});var e=c(9046),f=c(8667),g=c(3480),h=c(6435);let i={types:{tour:{stepMins:15,url:"https://tidycal.com/ddtenterpriseusa/15-minute-meeting"},meeting:{stepMins:30,url:"https://tidycal.com/ddtenterpriseusa/30-minute-meeting"}},workingWindows:{3:[{start:{h:17,m:0},end:{h:20,m:0}}],6:[{start:{h:11,m:0},end:{h:13,m:0}}],0:[{start:{h:14,m:0},end:{h:16,m:0}}]},bufferMins:120},j="We currently schedule on Wednesday (5–8pm), Saturday (11am–1pm), and Sunday (2–4pm). Tours are 15 minutes; meetings are 30 minutes.",k=a=>String(a).padStart(2,"0"),l=a=>`${a.getFullYear()}-${k(a.getMonth()+1)}-${k(a.getDate())}`,m=(a,b)=>a.toDateString()===b.toDateString(),n=(a,b)=>new Date(a.getTime()+6e4*b),o=(a,b)=>{let c=new Date(a);return c.setDate(c.getDate()+b),c},p=(a,b,c,d)=>a<d&&b>c;function q(a,b,c){let d=new Date(a);return d.setHours(b,c,0,0),d}function r(a,b){let c=a.getMinutes()%b;return 0===c?a:n(a,b-c)}function s(a){return i.workingWindows[a.getDay()]||[]}async function t(){let a=process.env.TIDYCAL_API_KEY,b=await fetch("https://tidycal.com/api/bookings",{headers:{Authorization:`Bearer ${a}`}}),c=await b.json();return c?.data||[]}function u({dateObj:a,typeKey:b,preference:c,bookings:d,afterISO:e,count:f=1,strategy:g="first"}){let h=function(a,b,c){let d=s(a),e=i.types[b].stepMins;if(!d.length)return[];let f=[];for(let b of d){let d=q(a,b.start.h,b.start.m),g=n(q(a,b.end.h,b.end.m),-e);if(g<d)continue;let h=q(a,12,0),i=d,j=g;if("morning"===c){if((j=n(h,-e))<d)continue}else if("afternoon"===c){if(g<h)continue;i=h>d?h:d}f.push({start:i,endStart:j,stepMins:e})}return f}(a,b,c);if(!h.length)return{slots:[],hadWindows:!1};let j=new Date,k=m(j,a),l=[];for(let b of h){let c=new Date(b.start);if(e){let b=/^\d{1,2}:\d{2}$/.test(e)?q(a,...e.split(":").map(Number)):new Date(e);m(b,a)&&b>c&&(c=b)}if(k){let a=r(n(j,i.bufferMins),b.stepMins);a>c&&(c=a)}c=r(c,b.stepMins);for(let a=new Date(c);a<=b.endStart;a=n(a,b.stepMins)){let c=n(a,b.stepMins);d.some(b=>{let d=new Date(b.starts_at),e=new Date(b.ends_at);return p(a,c,d,e)})||l.push({start:new Date(a),end:c})}}if(!l.length)return{slots:[],hadWindows:!0};let o=l.slice().sort((a,b)=>a.start-b.start);return{slots:(o="last"===g?o.slice(-f):o.slice(0,f)).map(({start:a,end:b})=>({start:a.toISOString(),end:b.toISOString(),human:a.toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})),hadWindows:!0}}function v({startDateObj:a,typeKey:b,preference:c,bookings:d,afterISO:e,count:f=3}){for(let g=0;g<60;g++){let h=o(a,g),i=u({dateObj:h,typeKey:b,preference:c,bookings:d,afterISO:e,count:f});if(i.slots.length)return{dateYMD:l(h),options:i.slots}}return null}async function w(a,b){if("GET"!==a.method)return b.status(405).json({error:"Method not allowed"});try{if(!process.env.TIDYCAL_API_KEY)return b.status(500).json({error:"Missing TidyCal API key"});let c=String(a.query.type||"meeting").toLowerCase(),d=String(a.query.preference||"").toLowerCase(),e=String(a.query.date||l(new Date)),f=a.query.after?String(a.query.after):"",g=Math.max(1,Math.min(5,Number(a.query.count)||1)),h=String(a.query.strategy||"first").toLowerCase();if(!i.types[c])return b.status(400).json({error:"Invalid booking type"});let k=function(a){let[b,c,d]=(a||"").split("-").map(Number),e=new Date;return b&&c&&d&&e.setFullYear(b,c-1,d),e.setHours(0,0,0,0),e}(e),m=await t();if(!s(k).length){let a=v({startDateObj:o(k,1),typeKey:c,preference:d,bookings:m,afterISO:f});return b.status(403).json({error:"Closed day",closedDay:!0,policy:j,type:c,preference:d,dateYMD:l(k),bookingUrl:i.types[c].url,nextAvailable:a})}let{slots:n,hadWindows:p}=u({dateObj:k,typeKey:c,preference:d,bookings:m,afterISO:f,count:g,strategy:h});if(!n.length){let a=v({startDateObj:o(k,1),typeKey:c,preference:d,bookings:m,afterISO:f});return b.status(404).json({error:p?"Fully booked":"Closed day",fullyBooked:p,closedDay:!p,policy:j,type:c,preference:d,dateYMD:l(k),bookingUrl:i.types[c].url,nextAvailable:a})}let q=n[0];return b.status(200).json({type:c,preference:d,dateYMD:l(k),bookingUrl:i.types[c].url,options:n,start:q.start,end:q.end,human:q.human,policy:j})}catch(a){return console.error("❌ /api/tidycal error:",a),b.status(500).json({error:"Failed to suggest a time"})}}var x=c(8112),y=c(8766);let z=(0,h.M)(d,"default"),A=(0,h.M)(d,"config"),B=new g.PagesAPIRouteModule({definition:{kind:f.A.PAGES_API,page:"/api/tidycal/suggest",pathname:"/api/tidycal/suggest",bundlePath:"",filename:""},userland:d,distDir:".next",relativeProjectDir:""});async function C(a,b,c){let d=await B.prepare(a,b,{srcPage:"/api/tidycal/suggest"});if(!d){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{query:f,params:g,prerenderManifest:h,routerServerContext:i}=d;try{let c=a.method||"GET",d=(0,x.getTracer)(),e=d.getActiveScopeSpan(),j=B.instrumentationOnRequestError.bind(B),k=async e=>B.render(a,b,{query:{...f,...g},params:g,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:h.preview,propagateError:!1,dev:B.isDev,page:"/api/tidycal/suggest",internalRevalidate:null==i?void 0:i.revalidate,onError:(...b)=>j(a,...b)}).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let f=d.getRootSpanAttributes();if(!f)return;if(f.get("next.span_type")!==y.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${f.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let g=f.get("next.route");if(g){let a=`${c} ${g}`;e.setAttributes({"next.route":g,"http.route":g,"next.span_name":a}),e.updateName(a)}else e.updateName(`${c} ${a.url}`)});e?await k(e):await d.withPropagatedContext(a.headers,()=>d.trace(y.BaseServerSpan.handleRequest,{spanName:`${c} ${a.url}`,kind:x.SpanKind.SERVER,attributes:{"http.method":c,"http.target":a.url}},k))}catch(a){if(B.isDev)throw a;(0,e.sendError)(b,500,"Internal Server Error")}finally{null==c.waitUntil||c.waitUntil.call(c,Promise.resolve())}}}};var b=require("../../../webpack-api-runtime.js");b.C(a);var c=b.X(0,[169],()=>b(b.s=5988));module.exports=c})();